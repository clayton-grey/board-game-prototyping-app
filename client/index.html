<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Board Game Prototyping</title>
    <link rel="stylesheet" href="css/style.css" />
  </head>
  <body>
    <div id="app">
      <!-- TOP-LEFT: Project Info -->
      <div id="project-info" class="floating-panel">
        <span id="project-name" title="Click to edit project name">Test</span>
        <button id="open-project-manager" title="Manage Project">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="16"
            height="16"
            fill="currentColor"
            viewBox="0 0 16 16"
          >
            <path d="M3 3h10v10H3V3zm9 9V4H4v8h8z" />
            <path d="M8 8.5l-4 2V6l4 2.5l4-2.5v4.5l-4-2z" />
          </svg>
        </button>
      </div>

      <!-- TOP-RIGHT: Local user info -->
      <div id="user-info" class="floating-panel">
        <span id="user-name">Anonymous</span>
        <div id="user-circle">
          <span id="user-circle-text">?</span>
        </div>

        <!-- Login popover if not logged in -->
        <div id="login-dropdown" class="floating-panel hidden">
          <form id="loginForm">
            <div class="login-row">
              <input
                type="email"
                id="loginEmail"
                placeholder="Email"
                required
              />
            </div>
            <div class="login-row">
              <input
                type="password"
                id="loginPassword"
                placeholder="Password"
                required
              />
            </div>
            <div class="login-actions">
              <a href="#" id="registerLink">Register</a>
              <button type="submit">Login</button>
            </div>
          </form>
        </div>
      </div>

      <!-- Session users list (floated left) -->
      <ul id="session-users-list" class="floating-panel"></ul>

      <!--
      TOOLS PALETTE (VERTICAL, LEFT SIDE).
      Defaulting to "select" tool.
    -->
      <div id="tools-palette" class="floating-panel left-tools-palette">
        <button
          data-tool="select"
          class="tool-btn selected"
          title="Select Tool"
        >
          Select
        </button>
        <button data-tool="rectangle" class="tool-btn" title="Draw Rectangle">
          Rectangle
        </button>
        <button data-tool="ellipse" class="tool-btn" title="Draw Ellipse">
          Ellipse
        </button>
        <button data-tool="text" class="tool-btn" title="Place Text Label">
          Text
        </button>
      </div>

      <!-- REGISTER MODAL -->
      <div id="register-modal" class="modal-backdrop hidden">
        <div class="modal-content floating-panel">
          <h2>Register Account</h2>
          <div id="register-message" class="message"></div>
          <form id="registerForm">
            <label for="regName">Name</label>
            <input type="text" id="regName" required />

            <label for="regEmail">Email</label>
            <input type="email" id="regEmail" required />

            <label for="regPassword">Password</label>
            <input type="password" id="regPassword" required />

            <label for="regConfirm">Confirm Password</label>
            <input type="password" id="regConfirm" required />

            <div style="margin-top: 1em">
              <button type="submit">Register</button>
              <button type="button" id="registerCancelBtn">Cancel</button>
            </div>
          </form>
        </div>
      </div>

      <!-- PROJECT MANAGEMENT MODAL -->
      <div id="project-manager-modal" class="modal-backdrop hidden">
        <div class="modal-content floating-panel">
          <h2>Project Management</h2>

          <div id="messageContainer"></div>

          <div class="versions-section">
            <h3>Versions</h3>
            <div class="versions-controls">
              <button id="loadVersionsBtn">Load Versions</button>
              <button id="saveNewVersionBtn">Save New Version</button>
            </div>
            <ul id="versionsList"></ul>
          </div>

          <div class="danger-section">
            <button id="deleteProjectBtn" class="danger">Delete Project</button>
          </div>

          <button id="close-project-manager">Close</button>
        </div>
      </div>

      <!-- MAIN CANVAS -->
      <canvas id="gameCanvas"></canvas>

      <!-- ZOOM CONTROLS (bottom-right) -->
      <div id="zoom-controls" class="floating-panel">
        <button id="zoom-out">-</button>
        <span id="zoom-level">100%</span>
        <button id="zoom-in">+</button>
        <button id="frame-all">Frame</button>
      </div>

      <!-- UNDO/REDO CONTROLS (bottom-left) -->
      <div id="undo-redo-controls" class="floating-panel">
        <button id="undo-btn" title="Undo (Ctrl+Z)">&#8630;</button>
        <button id="redo-btn" title="Redo (Ctrl+Y or Ctrl+Shift+Z)">
          &#8631;
        </button>
      </div>

      <!-- Chat UI -->
      <!-- MOVED to the right side to keep the left side for tools -->
      <div id="chat-container" class="floating-panel">
        <div id="chat-messages"></div>
        <div id="chat-input-row">
          <input type="text" id="chat-input" placeholder="Type a message..." />
          <button id="chat-send-btn">Send</button>
        </div>
      </div>

      <!-- A single global popover for user actions, absolutely positioned -->
      <div id="user-action-popover" class="hidden"></div>
    </div>

    <script type="module" src="js/app.js"></script>
  </body>
</html>
